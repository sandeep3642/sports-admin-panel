<!-- document-view.component.html -->
 
<div class="fixed inset-0 flex items-center justify-center backdrop-blur-sm bg-gray-900/20 z-50" 
     (keydown)="onKeyDown($event)" tabindex="-1">
  
  <!-- Modal Container -->
  <div class="bg-white rounded-xl shadow-2xl w-full max-w-4xl flex flex-col overflow-hidden transform transition-all duration-300 ease-out" style="max-height: 90vh;">

    <!-- Modal Header -->
    <div class="flex justify-between items-center px-6 py-4 border-b border-gray-200 bg-gray-50">
      <div class="flex items-center space-x-3">
        <div class="w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center">
          <i class="fa-solid fa-file-text text-blue-600 text-sm"></i>
        </div>
        <div>
          <h2 class="font-semibold text-lg text-gray-800">Document Viewer</h2>
          <p *ngIf="certificate?.title || certificate?.name" class="text-sm text-gray-500 truncate" style="max-width: 20rem;">
            {{ certificate?.title || certificate?.name }}
          </p>
        </div>
      </div>

      <div class="flex items-center space-x-2">
        <!-- Navigation (if multiple documents) -->
        <div *ngIf="certificates.length > 1" class="flex items-center space-x-2 mr-4">
          <button (click)="prev()" [disabled]="currentIndex === 0"
            class="p-2 rounded-lg hover:bg-white hover:shadow-sm disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200">
            <i class="fa-solid fa-chevron-left text-gray-600"></i>
          </button>

          <div class="px-3 py-1 bg-white rounded-lg border border-gray-200">
            <span class="text-sm font-medium text-gray-700">
              {{ currentIndex + 1 }} / {{ certificates.length }}
            </span>
          </div>

          <button (click)="next()" [disabled]="currentIndex === certificates.length - 1"
            class="p-2 rounded-lg hover:bg-white hover:shadow-sm disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200">
            <i class="fa-solid fa-chevron-right text-gray-600"></i>
          </button>
        </div>

        <!-- Action buttons -->
        <button *ngIf="certificate?.url || certificate?.file" (click)="downloadPDF()"
          class="p-2.5 rounded-lg hover:bg-blue-50 hover:text-blue-600 transition-all duration-200" 
          title="Download">
          <i class="fa-solid fa-download"></i>
        </button>

        <button (click)="openDialog()" 
          class="p-2.5 rounded-lg hover:bg-gray-100 transition-all duration-200" 
          title="More Options">
          <i class="fa-solid fa-ellipsis-vertical"></i>
        </button>

        <button class="p-2.5 rounded-lg hover:bg-red-50 hover:text-red-600 transition-all duration-200" 
          (click)="dialogRef.close()" 
          title="Close">
          <i class="fa-solid fa-times text-lg"></i>
        </button>
      </div>
    </div>

    <!-- Modal Content -->
    <div class="flex-1 overflow-hidden bg-gray-50">
      <div class="h-full flex items-center justify-center p-6">

        <!-- Document Content -->
        <ng-container *ngIf="certificate">
          
          <!-- Image Document -->
          <div *ngIf="certificate.file && !certificate.file.endsWith('.pdf')"
            class="w-full h-full flex items-center justify-center">
            <div class="relative max-w-full max-h-full">
              <img [src]="certificate.file" 
                   [alt]="certificate.title || certificate.name || 'Certificate'"
                   (error)="onImageError($event)"
                   class="max-w-full max-h-full w-auto h-auto object-contain rounded-lg shadow-lg bg-white" />
              
              <!-- Image loading state -->
              <div *ngIf="imageLoading" 
                class="absolute inset-0 bg-white rounded-lg flex items-center justify-center">
                <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
              </div>
            </div>
          </div>

          <!-- PDF Document -->
          <div *ngIf="certificate.file && certificate.file.endsWith('.pdf')"
            class="flex flex-col items-center justify-center space-y-6 text-center">
            
            <div class="w-24 h-24 bg-gradient-to-br from-red-100 to-red-200 rounded-2xl flex items-center justify-center shadow-lg">
              <i class="fa-solid fa-file-pdf text-red-500 text-4xl"></i>
            </div>
            
            <div class="space-y-3">
              <h3 class="text-2xl font-semibold text-gray-800">PDF Document</h3>
              <p *ngIf="certificate.title || certificate.name" 
                class="text-gray-600" style="max-width: 24rem;">
                {{ certificate.title || certificate.name }}
              </p>
              <p class="text-sm text-gray-500">
                Click below to download and view the PDF document
              </p>
            </div>
            
            <button (click)="downloadPDF()"
              class="bg-red-500 hover:bg-red-600 text-white px-8 py-3 rounded-lg transition-all duration-200 flex items-center space-x-3 shadow-lg hover:shadow-xl transform hover:-translate-y-0.5">
              <i class="fa-solid fa-download"></i>
              <span class="font-medium">Download PDF</span>
            </button>
          </div>

        </ng-container>

        <!-- No Document State -->
        <div *ngIf="!certificate" 
          class="flex flex-col items-center justify-center text-center space-y-6">
          
          <div class="w-20 h-20 bg-gray-100 rounded-full flex items-center justify-center">
            <i class="fa-solid fa-file-circle-exclamation text-gray-400 text-3xl"></i>
          </div>
          
          <div class="space-y-2">
            <h3 class="text-xl font-medium text-gray-700">No Document Available</h3>
            <p class="text-gray-500" style="max-width: 20rem;">
              The selected document could not be loaded or does not exist.
            </p>
          </div>
          
          <button (click)="dialogRef.close()"
            class="px-6 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg transition-colors">
            Close
          </button>
        </div>

      </div>
    </div>

    <!-- Modal Footer (optional) -->
    <div *ngIf="certificate && (certificate.description || certificate.date)" 
      class="px-6 py-4 border-t border-gray-200 bg-white">
      <div class="flex justify-between items-center text-sm">
        <span *ngIf="certificate.description" class="text-gray-600 truncate">
          {{ certificate.description }}
        </span>
        <span *ngIf="certificate.date" class="text-gray-500 ml-4">
          {{ certificate.date | date:'mediumDate' }}
        </span>
      </div>
    </div>

  </div>
</div>