<div class="mt-6 border border-[#2F2F2F]/30 rounded-lg">
  <div class="p-4">
    <!-- Search and Filter Section -->

    <div class="grid grid-cols-12 gap-4 items-center">
      <!-- Search Bar - span 7 columns -->
      <div class="relative col-span-12 md:col-span-7">
        <input type="text" placeholder="Search for athletes & coaches and their approve status......." class="w-full pl-14 pr-4 py-3 rounded-lg border border-[#2F2F2F]/30 focus:outline-none text-sm text-black" [(ngModel)]="filters.search" (ngModelChange)="getStakeList(1)" name="search" />
        <span class="absolute left-2 top-1 bg-[#FAFAFA] w-8.5 h-8.5 flex justify-center items-center rounded-md">
          <svg-icon src="/assets/icons/search-ico.svg"></svg-icon>
        </span>
      </div>

      <!-- Filter Button - span 2 columns -->
      <div class="relative col-span-6 md:col-span-2">
        <button class="flex items-center cursor-pointer border border-gray-300 rounded-lg px-2 py-1 bg-white text-sm font-medium gap-2 min-w-full shadow-sm w-full" (click)="openFilterModal()" type="button">
          <span style="background:#EEEEEE; height:32px; width:32px; display:flex; align-items:center; justify-content:center;" class="rounded-md">
            <svg-icon src="../../../../../../assets/stackholder/filter.svg" class="w-4 h-4 text-gray-500"></svg-icon>
          </span>
          <span class="text-gray-700 ml-1">Filter</span>
          <svg class="w-4 h-4 text-gray-400 ml-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
          </svg>
        </button>

      </div>

      <!-- Sort Button - span 2 columns -->
      <div class="relative col-span-6 md:col-span-2">
        <button class="flex items-center border border-gray-300 cursor-pointer rounded-lg px-2 py-1 bg-white text-sm font-medium gap-2 min-w-full  w-full" (click)="isSortDropdownOpen = !isSortDropdownOpen" type="button">
          <span style="background:#EEEEEE; height:32px; width:32px; display:flex; align-items:center; justify-content:center;" class="rounded-md">
            <svg-icon src="../../../../../../assets/icons/sortby-ico.svg" class="w-4 h-4 text-gray-500"></svg-icon>
          </span> <span class="text-gray-400">| </span>
          <span class="text-gray-700 ml-1">Sort By</span>
          <svg class="w-4 h-4 text-gray-400 ml-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
          </svg>
        </button>
        <div *ngIf="isSortDropdownOpen" class="absolute left-0 mt-2 w-full bg-white border border-gray-200 rounded-lg shadow-lg z-50">
          <ul class="py-1 cursor-pointer">
            <li><button class="w-full text-left px-4 py-2 hover:bg-gray-100 text-sm" (click)="selectSort('ASC')">Ascending</button></li>
            <li><button class="w-full text-left px-4 py-2 hover:bg-gray-100 text-sm" (click)="selectSort('DESC')">Descending</button></li>
          </ul>
        </div>
      </div>

      <!-- Download Button - span 1 column -->
      <div class="col-span-12 md:col-span-1">
        <button class="p-2 px-3 bg-[#075FB0] text-white rounded-lg cursor-pointer" (click)="Exportdialog()">
          <svg-icon src="/assets/icons/tab-download.svg"></svg-icon>
        </button>
      </div>
    </div>


    <!-- Table -->
    <div class="mt-6 overflow-x-auto">
      <table class="w-full text-sm ">
        <thead>
          <tr class="text-left border-b [&>th]:font-semibold">
            <th class="pb-4">SL</th>
            <th class="pb-4">Name</th>
            <th class="pb-4">Sports Type</th>
            <th class="pb-4">Role <i class="fa-solid fa-chevron-down font-normal"></i></th>
            <th class="pb-4">District</th>
            <th class="pb-4">Status</th>
            <th class="pb-4">Registration Date</th>
            <th class="pb-4">Action</th>
          </tr>
        </thead>
        <tbody>
          <ng-container *ngFor="let user of stakelist; let i = index">
            <tr class="border-b cursor-pointer">
              <td class="py-4 cursor-pointer">
                {{ i + 1}}
              </td>
              <td class="cursor-pointer">
                {{ user.full_name }}
              </td>
              <td class="cursor-pointer">
                {{ user?.sport_type?.label || '--' }}
              </td>
              <td class="cursor-pointer">{{user?.customer_type || '--'}}</td>
              <td class="cursor-pointer">
                {{ user?.district?.label || '--' }}
              </td>
              <td class="cursor-pointer">
                <div class="flex items-center gap-2">
                  <!-- Progress bar -->
                  <div class="w-12 h-2 bg-orange-200 rounded-full">
                    <div class="h-full rounded-full" [ngClass]="{
                      'bg-green-600': user.profile_status?.approved?.is_active,
                      'bg-red-500': user.profile_status?.rejected?.is_active,
                      'bg-orange-500': !user.profile_status?.approved?.is_active && !user.profile_status?.rejected?.is_active
                    }" [ngStyle]="{
                      width: getProgressPercent(user.profile_status)
                    }">
                    </div>
                  </div>

                  <!-- Status Text and Icon -->
                  <div class="shadow-[0_0_10px_rgba(0,0,0,0.1)] rounded-full flex gap-2 items-center py-1 px-2 text-xs">
                    <img *ngIf="user.profile_status?.approved?.is_active" src="../../../../../../assets/stackholder/greencheck.svg" alt="Approved" class="inline-block" />
                    <img *ngIf="user.profile_status?.rejected?.is_active" src="../../../../../../assets/stackholder/cancel1.svg" alt="Rejected" class="inline-block" />
                    <img *ngIf="!user.profile_status?.approved?.is_active && !user.profile_status?.rejected?.is_active" src="../../../../../../assets/stackholder/explain.svg" alt="Pending" class="inline-block" />

                    <span *ngIf="isFinalStatus(user.profile_status); else progressText">
                      {{ getFinalStatus(user.profile_status) }}
                    </span>
                    <ng-template #progressText>
                      {{ getActiveStepCount(user.profile_status) }}/
                      {{ getTotalStepCount(user.profile_status) }}
                    </ng-template>
                  </div>
                </div>
              </td>



              <td>
                {{ user?.created_at | date: 'dd/MM/yyyy'}}
              </td>

              <td>
                <button tone="primary" class="rounded-lg p-2 w-7.5 h-7.5 text-white cursor-pointer" size="medium" (click)="toggleRow(user.id)" [ngClass]="{
                  'bg-black': expandedUserId !== user.id,
                  'bg-[#075FB0]': expandedUserId === user.id
                }">
                  <svg-icon src="/assets/icons/action-arrow.svg"></svg-icon>
                </button>
              </td>
            </tr>

            <tr *ngIf="expandedUserId === user.id">
              <td colspan="9" class="px-6 py-4 bg-gray-50 text-sm text-gray-700">
                <div class="flex justify-between items-center border-b-1 pb-3">
                  <p class="text-lg font-bold text-[#2F2F2F]">Review and Verify</p>
                  <div class="flex justify-between items-center gap-4" *ngIf="!user.profile_status?.approved?.is_active && !user.profile_status?.rejected?.is_active">
                    <app-button impact="bold" shape="rounded" tone="danger" size="medium" (click)="rejectProfile(expandedUserId)">Reject
                    </app-button>
                    <app-button impact="bold" shape="rounded" tone="success" size="medium" class="text-white" (click)="approveProfile(expandedUserId)">Approve
                    </app-button>
                  </div>
                </div>
                <!-- {{ user.details }} -->

                <div class="max-w-full rounded-xl border border-gray-200 p-6 bg-white mt-2">
                  <div class="flex justify-start items-center gap-2">
                    <h2 class="text-lg">Profile Approval Status</h2>
                    <span class="text-white bg-[#1A1A1A] px-2 py-1 rounded">
                      {{ getActiveStepCount(user.profile_status) }}/
                      {{ getTotalStepCount(user.profile_status) }}
                    </span>
                  </div>

                  <div class="my-4">
                    <nav class="flex items-center space-x-0">
                      <ng-container *ngFor="let step of getSortedSteps(user.profile_status); let last = last">
                        <!-- Step -->
                        <div class="flex items-center bg-white rounded-full shadow px-5 py-2 space-x-3">
                          <div class="flex justify-center items-center w-7 h-7 rounded-full text-white text-sm" [ngClass]="{
                              'bg-green-700': step.is_active,
                              'bg-orange-500': !step.is_active
                            }">
                            <i class="fas" [ngClass]="step.is_active ? 'fa-check' : 'fa-exclamation'"></i>
                          </div>
                          <span class="text-black text-base font-normal leading-6">
                            {{ step.label }}
                          </span>
                        </div>

                        <!-- Line -->
                        <div *ngIf="!last" class="w-12 h-[2px] mx-3" [ngClass]="step.is_active ? 'bg-green-700' : 'bg-gray-300'"></div>
                      </ng-container>
                    </nav>
                  </div>
                </div>


                <div class="max-w-full rounded-xl border border-gray-200 p-6 bg-white mt-2">
                  <div class="flex justify-between items-center mb-4">
                    <div class="flex justify-start items-center gap-2">
                      <h2 class="text-lg font-semibold">Submitted Documents</h2>
                      <span class="text-white bg-[#1A1A1A] p-2 rounded aspect-1">
                        {{ stakeDetails?.documents?.length
                        || 0 }}</span>
                    </div>
                    <div class="flex justify-start items-center gap-2">
                      <i class="fa-solid fa-arrow-left text-black border-1 p-2 rounded"></i>
                      <i class="fa-solid fa-arrow-right text-white bg-black border-1 p-2 rounded"></i>
                    </div>
                  </div>

                  <!-- <owl-carousel-o [options]="customOptions"> -->
                  <div class="grid justify-start items-start grid-cols-6 gap-6 flex-row">
                    <ng-container *ngIf="stakeDetails?.documents.length; else noCertificates">
                      <div *ngFor="let cert of stakeDetails.documents; let i = index" class="bg-white rounded-lg shadow p-3 w-full">
                        <div class="relative w-32 h-32 bg-[#FAFAFA] flex items-center justify-center rounded overflow-hidden border border-gray-200" [ngClass]="{
                          'ring-2 ring-green-500': cert.is_approved,
                          'ring-2 ring-red-500': cert.is_rejected
                        }">
                          <!-- Document Image -->
                          <img [src]="cert.file_url || '/assets/images/certificate-1.png'" alt="Document" class="w-full h-full object-contain" />

                          <!-- Top-right Approve/Reject Buttons or Status -->
                          <div class="absolute top-1 right-1 flex gap-1">
                            <!-- Approve / Reject Buttons -->
                            <ng-container *ngIf="!cert.is_approved && !cert.is_rejected">
                              <button (click)="approveCertificate(cert)" class="bg-white text-green-600 border border-green-600 rounded-sm py-1 px-2.5 hover:bg-green-600 hover:text-white transition" title="Approve">
                                <i class="fa fa-check text-md font-bold"></i>
                              </button>

                              <button (click)="rejectCertificate(cert)" class="bg-white text-red-600 border border-red-600 rounded-sm py-1 px-2.5 hover:bg-red-600 hover:text-white transition" title="Reject">
                                <i class="fa fa-times text-md font-bold"></i>
                              </button>
                            </ng-container>

                            
                          </div>

                          <!-- Bottom Center Status Badge -->
                          <div *ngIf="cert.is_approved || cert.is_rejected" class="absolute bottom-1 left-1/2 transform -translate-x-1/2 text-xs font-semibold px-2 py-0.5 rounded-full" [ngClass]="{
                            'bg-green-100 text-green-700 border border-green-600': cert.is_approved,
                            'bg-red-100 text-red-700 border border-red-600': cert.is_rejected
                          }">
                            {{ cert.is_approved ? 'Approved' : 'Rejected' }}
                          </div>
                        </div>


                        <h3 class="mt-2 text-sm pb-2 border-b-1  text-[#2F2F2F]">
                          {{ cert.title || 'Certificate'
                          }}
                        </h3>
                        <div class="mt-2 flex justify-between items-center gap-4">
                          <a *ngIf="cert.file_url" href="#" (click)="openCertificateDialog(cert, i); $event.preventDefault()" class="flex items-center justify-center gap-1 bg-[#1A1A1A] text-white px-3 py-2 rounded text-sm w-3/4 cursor-pointer">
                            <svg-icon src="/assets/icons/view-eyes.svg"></svg-icon>
                            View
                          </a>
                          <span *ngIf="!cert.file_url" class="flex items-center justify-center gap-1 bg-gray-300 text-gray-600 px-3 py-2 rounded text-sm w-3/4 text-center cursor-not-allowed">
                            <svg-icon src="/assets/icons/view-eyes.svg"></svg-icon>
                            No File
                          </span>
                          <a *ngIf="cert.file_url" (click)="downloadFile(cert); $event.preventDefault()" class="bg-gray-100 p-2 cursor-pointer rounded w-1/4 flex justify-center items-center">
                            <i class="fa fa-download"></i>
                          </a>
                          <span *ngIf="!cert.file_url" class="bg-gray-100 p-2 rounded cursor-pointer w-1/4 flex justify-center items-center text-gray-400">
                            <i class="fa fa-download"></i>
                          </span>
                        </div>
                      </div>
                    </ng-container>
                    <ng-template #noCertificates>
                      <div class="col-span-6 text-center text-gray-400 py-8">No certificates found.</div>
                    </ng-template>
                  </div>
                </div>


                <div class="max-w-full rounded-xl border border-gray-200 p-6 bg-white mt-2">
                  <div class="flex justify-between items-center mb-6">
                    <h2 class="text-lg font-semibold text-gray-900">Applicant's Details</h2>
                    <button class="bg-black text-white text-sm font-normal cursor-pointer rounded-md px-5 py-2.5 hover:bg-gray-900 transition" type="button" (click)="viewFullProfile(stakeDetails?.id)">
                      View Full Profile
                    </button>
                  </div>
                  <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-4">
                    <div class="bg-white rounded-lg p-2 shadow-sm flex items-center space-x-3">
                      <i class="fas fa-envelope text-green-700 text-xl flex-shrink-0"></i>
                      <div>
                        <p class="text-sm text-gray-900 mb-1">Email</p>
                        <p class="text-sm">{{stakeDetails?.email}}</p>
                      </div>
                    </div>
                    <div class="bg-white rounded-lg p-2 shadow-sm flex items-center space-x-3">
                      <i class="fas fa-phone-alt text-green-700 text-xl flex-shrink-0"></i>
                      <div>
                        <p class="text-sm text-gray-900 mb-1">Phone Number</p>
                        <p class="text-sm text-gray-900">{{stakeDetails?.phone}}</p>
                      </div>
                    </div>
                    <div class="bg-white rounded-lg p-2 shadow-sm flex items-center space-x-3">
                      <i class="fas fa-calendar-alt text-green-700 text-xl flex-shrink-0"></i>
                      <div>
                        <p class="text-sm text-gray-900 mb-1">Date of Birth</p>
                        <p class="text-sm text-gray-900">{{stakeDetails?.dob || "--"}}</p>
                      </div>
                    </div>
                    <div class="bg-white rounded-lg p-2 shadow-sm flex items-center space-x-3">
                      <i class="fas fa-crosshairs text-green-700 text-xl flex-shrink-0"></i>
                      <div>
                        <p class="text-sm text-gray-900 mb-1">Full Address</p>
                        <p class="text-sm text-gray-900">
                          {{stakeDetails?.full_address || "--"}}
                        </p>
                      </div>
                    </div>
                    <div class="bg-white rounded-lg p-2 shadow-sm flex items-center space-x-3">
                      <i class="fas fa-graduation-cap text-green-700 text-xl flex-shrink-0"></i>
                      <div>
                        <p class="text-sm text-gray-900 mb-1">Qualification</p>
                        <p class="text-sm text-gray-900"> {{stakeDetails?.highest_qualification_name.label || "--"}}
                        </p>
                      </div>
                    </div>
                    <div class="bg-white rounded-lg p-2 shadow-sm flex items-center space-x-3">
                      <i class="fas fa-basketball-ball text-green-700 text-xl flex-shrink-0"></i>
                      <div>
                        <p class="text-sm text-gray-900 mb-1">Sports Type & Role</p>
                        <p class="text-sm text-gray-900">{{stakeDetails?.sport_type.label || "--"}}</p>
                      </div>
                    </div>
                    <div class="bg-white rounded-lg p-2 shadow-sm flex items-center space-x-3">
                      <i class="fas fa-shield-alt text-green-700 text-xl flex-shrink-0"></i>
                      <div>
                        <p class="text-sm text-gray-900 mb-1">Current Club</p>
                        <p class="text-sm text-gray-900">{{stakeDetails?.current_club || "--"}}</p>
                      </div>
                    </div>
                    <div class="bg-white rounded-lg p-2 shadow-sm flex items-center space-x-3">
                      <i class="fas fa-award text-green-700 text-xl flex-shrink-0"></i>
                      <div>
                        <p class="text-sm text-gray-900 mb-1">Year of Experience</p>
                        <p class="text-sm text-gray-900">{{stakeDetails?.experience_year || "--"}}</p>
                      </div>
                    </div>
                    <div class="bg-white rounded-lg p-2 shadow-sm flex items-center space-x-3 col-span-1">
                      <i class="fas fa-mars text-green-700 text-xl flex-shrink-0"></i>
                      <div>
                        <p class="text-sm text-gray-900 mb-1">Gender</p>
                        <p class="text-sm text-gray-900">{{stakeDetails?.gender || "--"}}</p>
                      </div>
                    </div>
                  </div>
                </div>

              </td>
            </tr>

          </ng-container>
        </tbody>
      </table>
    </div>
    <!-- Pagination Controls -->
    <div class="flex justify-start items-center gap-2 mt-4" style="width:100%">
      <label for="pageSize" class="mr-2 text-sm">Show</label>
      <select id="pageSize" [(ngModel)]="pageSize" (change)="onPageSizeChange()" class="border rounded px-2 py-2 text-sm " style="width: 8%; min-width: 50px; max-width: 100px;">
        <option [ngValue]="10">10</option>
        <option [ngValue]="20">20</option>
        <option [ngValue]="50">50</option>
        <option [ngValue]="100">100</option>
      </select>

      <button (click)="onPageChange(currentPage - 1)" [disabled]="currentPage === 1" class="px-2 py-1 rounded">
        <i class="fa fa-chevron-left cursor-pointer"></i>
      </button>
      <ng-container *ngFor="let page of [].constructor(totalPages); let idx = index">
        <button (click)="onPageChange(idx + 1)" [ngStyle]="currentPage === (idx + 1) ? {'background': '#075FB01A', 'color': '#075FB0'} : {}" class="px-3 py-1 rounded cursor-pointer">
          {{ idx + 1 }}
        </button>
      </ng-container>
      <button (click)="onPageChange(currentPage + 1)" [disabled]="currentPage === totalPages" class="px-2 py-1 rounded">
        <i class="fa fa-chevron-right cursor-pointer"></i>
      </button>
    </div>
  </div>
</div>

<!-- Filter Modal -->
<div *ngIf="isFilterModalOpen" class="fixed inset-0 z-50 flex items-center justify-center  bg-opacity-30" style="backdrop-filter: blur(6px); -webkit-backdrop-filter: blur(6px);">
  <div class="bg-white rounded-lg shadow-lg w-full max-w-2xl flex flex-col" style="max-height:90vh;">
    <!-- Header -->
    <div class="flex items-center justify-between border-b px-6 py-4">
      <h2 class="text-lg font-semibold">Apply Filter</h2>
      <button (click)="closeFilterModal()" class="text-gray-500 hover:text-black text-2xl">&times;</button>
    </div>
    <!-- Body: Two columns -->
    <div class="flex flex-1 min-h-0" style="height:400px;">
      <!-- Sidebar: Categories -->
      <div class="w-1/3 border-r bg-[#FAFAFA] p-0 overflow-y-auto">
        <ul class="py-2">
          <li *ngFor="let cat of filterCategories" (click)="selectCategory(cat)" class="cursor-pointer px-6 py-3 hover:bg-gray-100" [ngClass]="{
                'bg-white font-semibold text-[#075FB0] border-l-4 border-[#075FB0]': selectedCategory === cat,
                'text-gray-700': selectedCategory !== cat
              }">
            {{ cat }}
          </li>
        </ul>
      </div>
      <!-- Main: Filter options -->
      <div class="flex-1 flex flex-col p-0">
        <!-- Search bar -->
        <div class="px-6 py-4 border-b">
          <input type="text" [(ngModel)]="filterSearch" placeholder="Search" class="w-full px-3 py-2 border rounded bg-[#F5F5F5] text-sm" />
        </div>
        <!-- Filter options -->
        <div class="flex-1 px-6 py-4 overflow-y-auto">
          <h3 class="font-semibold mb-3">
            {{ selectedCategory }}
          </h3>
          <ng-container [ngSwitch]="selectedCategory">
            <div *ngSwitchCase="'User Type'">
              <label *ngFor="let type of filteredUserTypes" class="flex items-center gap-2 mb-2">
                <input type="checkbox" [(ngModel)]="selectedUserTypes[type]" />
                {{ type }}
              </label>
            </div>
            <div *ngSwitchCase="'Sports Category'">
              <label *ngFor="let cat of filteredSportsCategories" class="flex items-center gap-2 mb-2">
                <input type="checkbox" [(ngModel)]="selectedSportsCategories[cat]" />
                {{ cat }}
              </label>
            </div>
            <div *ngSwitchCase="'Level'">
              <label *ngFor="let level of filteredLevels" class="flex items-center gap-2 mb-2">
                <input type="checkbox" [(ngModel)]="selectedLevels[level]" />
                {{ level }}
              </label>
            </div>
            <div *ngSwitchCase="'District'">
              <label *ngFor="let district of filteredDistricts" class="flex items-center gap-2 mb-2">
                <input type="checkbox" [(ngModel)]="selectedDistricts[district]" />
                {{ district }}
              </label>
            </div>
            <!-- Repeat for other categories -->
            <div *ngSwitchDefault>
              <p class="text-gray-400">No options for this filter yet.</p>
            </div>
          </ng-container>
        </div>
      </div>
    </div>
    <!-- Footer -->
    <div class="flex justify-between items-center border-t px-6 py-4">
      <button (click)="clearAllFilters()" class="bg-gray-100 text-black px-4 py-2 rounded">Clear All</button>
      <button (click)="applyFilters()" class="bg-[#075FB0] text-white px-4 py-2 rounded">Apply Filter</button>
    </div>
  </div>
</div>