<div>
    <app-role-stats-card [countsData]="countsData"></app-role-stats-card>


    <div class="mt-6 border border-[#2F2F2F]/30 rounded-lg">
        <div class="">
            <div class="grid grid-cols-12 gap-4 items-center px-5">
                <!-- Search Bar - span 7 columns -->
                <div class="relative col-span-12 md:col-span-5">
                    <input type="text" placeholder="Search For role...."
                        class="w-full pl-14 pr-4 py-3 rounded-lg border border-[#2F2F2F]/30 focus:outline-none text-sm text-black"
                        name="search" [(ngModel)]="searchTerm" (ngModelChange)="applyFilters()" />
                    <span
                        class="absolute left-2 top-1 bg-[#FAFAFA] w-8.5 h-8.5 flex justify-center items-center rounded-md">
                        <svg-icon src="/assets/icons/search-ico.svg"></svg-icon>
                    </span>
                </div>

                <!-- Sort Button - span 2 columns -->
                <div class="relative col-span-6 md:col-span-3">
                    <div class="relative  text-left" (clickOutside)="showFilter = false">
                        <!-- Filter Button -->
                        <button (click)="showFilter = !showFilter"
                            class="flex items-center cursor-pointer border border-gray-300 rounded-lg px-2 py-1 bg-white text-sm font-medium gap-2 min-w-full shadow-sm w-full"
                            type="button">
                            <span
                                style="background:#EEEEEE; height:32px; width:32px; display:flex; align-items:center; justify-content:center;"
                                class="rounded-md">
                                <svg-icon src="../../../../../../assets/stackholder/filter.svg"
                                    class="w-4 h-4 text-gray-500"></svg-icon>
                            </span>
                            <span class="text-gray-700 ml-1">Filter</span>
                            <svg class="w-4 h-4 text-gray-400 ml-auto" fill="none" stroke="currentColor"
                                viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M19 9l-7 7-7-7" />
                            </svg>
                        </button>

                        <!-- Dropdown Menu -->
                        <div *ngIf="showFilter"
                            class="absolute right-0 mt-2 w-44 bg-white border border-gray-200 rounded-md shadow-lg z-20">
                            <button class="block w-full px-4 py-2 text-left text-sm text-gray-700 hover:bg-gray-100"
                                (click)="applyFilter('active')">
                                Active
                            </button>
                            <button class="block w-full px-4 py-2 text-left text-sm text-gray-700 hover:bg-gray-100"
                                (click)="applyFilter('inactive')">
                                Inactive
                            </button>
                            <button class="block w-full px-4 py-2 text-left text-sm text-gray-500 hover:bg-gray-100"
                                (click)="applyFilter('all')">
                                Clear Filter
                            </button>
                        </div>
                    </div>

                </div>
                <div class="md:col-span-2">
                    <app-button impact="bold" shape="rounded" tone="primary" size="medium" fit class="white-nowrap px-2"
                        (click)="createNewRole()"> <img
                            src="../../../../../assets/usermanagement/add_24dp_E3E3E3_FILL1_wght400_GRAD0_opsz24 1.svg"
                            class="px-1">
                        <span class="pr-2">Create New Role
                        </span>
                    </app-button>
                </div>
                <div class="md:col-span-2">
                    <app-button impact="bold" shape="rounded" tone="primary" size="medium" fit class="white-nowrap px-2"
                        (click)="openChooseTemplateModal()">
                        <span class="pr-2">Manage Permission</span>
                    </app-button>
                </div>
            </div>

            <!-- Table -->
            <div class="mt-2 overflow-x-auto ">
                <table class="w-full text-sm table-fixed">
                    <thead>
                        <tr class="text-left border [&>th]:font-semibold ">
                            <th class="pb-4 w-[15%] pl-3 py-4">SL</th>
                            <th class="pb-4 w-[40%] py-4">Role Name</th>
                            <th class="pb-4 w-[30%] py-4">Status</th>
                            <th class="pb-4 w-[5%] py-4"> Action </th>
                        </tr>
                    </thead>
                    <tbody>
                        <ng-container *ngFor="let role of rolelist; let i = index">
                            <tr class="border-b cursor-pointer">
                                <td class="py-4 pl-3">{{ i + 1 }}</td>
                                <td>{{ role?.name || '--' }}</td>
                                <td>
                                    <div class="flex items-center gap-2">
                                        <ng-container *ngIf="role?.status === 'active'; else inactiveBlock">
                                            <div
                                                class="shadow-[0_0_10px_rgba(0,0,0,0.1)] rounded-full flex gap-2 items-center py-1 px-2 text-xs">
                                                <span>
                                                    <img src="../../../../../assets/usermanagement/active.svg">
                                                </span>
                                                {{ role?.status | titlecase }}
                                            </div>
                                        </ng-container>

                                        <ng-template #inactiveBlock>
                                            <div
                                                class="shadow-[0_0_10px_rgba(0,0,0,0.1)] rounded-full flex gap-2 items-center py-1 px-2 text-xs">
                                                <span>
                                                    <img src="../../../../../assets/role/Ellipse 17.svg">
                                                </span>
                                                {{ role?.status | titlecase }}
                                            </div>
                                        </ng-template>
                                    </div>

                                </td>
                                <td class="p-0 border-0">
                                    <div class="relative inline-block w-full dropdown-wrapper">
                                        <img src="../../../../../../assets/usermanagement/line.svg"
                                            class="rounded-lg p-2 w-7.5 h-7.5 text-white cursor-pointer bg-black"
                                            (click)="toggleDropdown(i)" />

                                        <!-- Dropdown opens above the icon -->
                                        <div *ngIf="activeDropdown === i"
                                            class="absolute right-0 top-full  mb-2 w-60 bg-white rounded shadow-lg z-20">
                                            <button
                                                class="flex items-center gap-2 w-full px-4 py-3 text-left hover:bg-gray-100 border"
                                                (click)="openChooseTemplateModal()">
                                                <img src="../../../../../assets/role/Vector (19).svg" class="w-5 h-5" />
                                                <span class="text-green-700 font-medium">View Role</span>
                                            </button>

                                            <button
                                                class="flex items-center gap-2 w-full px-4 py-3 text-left hover:bg-gray-100 border"
                                                (click)="openChooseTemplateModal()">
                                                <img src="../../../../../../assets/usermanagement/edit_document_24dp_E3E3E3_FILL0_wght400_GRAD0_opsz24 1.svg"
                                                    class="w-5 h-5" />
                                                <span class="text-blue-700 font-medium">Edit Role</span>
                                            </button>

                                            <button
                                                class="flex items-center gap-2 w-full px-4 py-3 text-left hover:bg-gray-100 border">
                                                <img src="../../../../../../assets/usermanagement/cancel_24dp_E3E3E3_FILL0_wght400_GRAD0_opsz24 (1) 1.svg"
                                                    class="w-5 h-5" />
                                                <span class="text-red-500 font-medium">Remove Role</span>
                                            </button>
                                        </div>
                                    </div>
                                </td>

                            </tr>
                        </ng-container>
                    </tbody>
                </table>
            </div>
            <!-- Pagination Controls -->
            <div class="flex justify-start items-center gap-2  p-4" style="width:100%">
                <label for="pageSize" class="mr-2 text-sm">Show</label>
                <select id="pageSize" [(ngModel)]="pageSize" (change)="onPageSizeChange()"
                    class="border rounded px-2 py-2 text-sm " style="width: 8%; min-width: 50px; max-width: 100px;">
                    <option [ngValue]="10">10</option>
                    <option [ngValue]="20">20</option>
                    <option [ngValue]="50">50</option>
                    <option [ngValue]="100">100</option>
                </select>

                <button (click)="onPageChange(currentPage - 1)" [disabled]="currentPage === 1"
                    class="px-2 py-1 rounded">
                    <i class="fa fa-chevron-left cursor-pointer"></i>
                </button>
                <ng-container *ngFor="let page of [].constructor(totalPages); let idx = index">
                    <button (click)="onPageChange(idx + 1)"
                        [ngStyle]="currentPage === (idx + 1) ? {'background': '#075FB01A', 'color': '#075FB0'} : {}"
                        class="px-3 py-1 rounded cursor-pointer">
                        {{ idx + 1 }}
                    </button>
                </ng-container>
                <button (click)="onPageChange(currentPage + 1)" [disabled]="currentPage === totalPages"
                    class="px-2 py-1 rounded">
                    <i class="fa fa-chevron-right cursor-pointer"></i>
                </button>
            </div>
        </div>
    </div>

    <div *ngIf="isModalOpen" class="fixed inset-0 z-50 flex items-center justify-center  bg-opacity-30"
        style="backdrop-filter: blur(2px); -webkit-backdrop-filter: blur(6px);">
        <div class="w-full max-w-xl bg-white rounded-xl shadow p-6">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-xl font-semibold">Edit User</h2>
                <button class="text-gray-500 hover:text-gray-700">
                    <button (click)="closeChooseTemplateModal()"
                        class="text-gray-500 cursor-pointer hover:text-black text-2xl">&times;</button>

                </button>
            </div>

            <form [formGroup]="editUserForm" (ngSubmit)="onSubmit()">
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Full Name</label>
                        <input type="text" formControlName="fullName"
                            class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-600" />
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">User Name</label>
                        <input type="text" formControlName="userName"
                            class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-600" />
                    </div>
                </div>

                <!-- Email -->
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-1">Email Address</label>
                    <input type="email" formControlName="email"
                        class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-600" />
                </div>

                <!-- Role -->
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-1">Role</label>
                    <select formControlName="role"
                        class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-600">
                        <option value="approve">Approve</option>
                        <option value="reject">Reject</option>
                    </select>
                </div>

                <!-- Create Password -->
                <div class="mb-4 relative">
                    <label class="block text-sm font-medium text-gray-700 mb-1">Create Password</label>
                    <input type="password" formControlName="password"
                        class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-600 pr-10" />
                    <button type="button" class="absolute top-8 right-3 text-gray-500" (click)="togglePassword()">
                        👁️
                    </button>
                </div>

                <!-- Status -->
                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 mb-1">Status</label>
                    <select formControlName="status"
                        class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-600">
                        <option value="active">Status: Active</option>
                        <option value="inactive">Status: Inactive</option>
                    </select>
                </div>

                <!-- Submit -->
                <div class="flex justify-start">
                    <button type="submit"
                        class="bg-[#075FB0] text-white font-semibold px-5 py-2 rounded-md hover:bg-blue-700 focus:ring-2 focus:ring-blue-500">
                        Save
                    </button>
                </div>
            </form>
        </div>

    </div>

    <div *ngIf="isRoleOpen" class="fixed inset-0 z-50 flex items-center justify-center bg-opacity-30"
    style="backdrop-filter: blur(2px); -webkit-backdrop-filter: blur(6px); background: rgba(0, 0, 0, 0.3);">
    
    <div class="fixed flex items-center justify-center z-50">
      <div class="bg-white rounded-lg w-96 shadow-lg p-6 relative">
        
        <!-- Header -->
        <div class="flex justify-between items-center mb-4 border-b py-2">
          <h2 class="text-lg font-semibold">Create New Role</h2>
          <button (click)="closeRole()" class="text-gray-500 cursor-pointer hover:text-black text-xl">&times;</button>
        </div>
  
        <!-- Form Start -->
        <form [formGroup]="roleForm" (ngSubmit)="roleCreate()">
          
          <!-- Role Name -->
          <div class="mb-4">
            <label class="block text-sm font-medium mb-1">Role Name</label>
            <input
              type="text"
              formControlName="roleName"
              class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
            />
            <div *ngIf="roleForm.get('roleName')?.invalid && roleForm.get('roleName')?.touched"
              class="text-red-500 text-sm mt-1">
              Role name is required.
            </div>
          </div>
  
          <!-- Status Dropdown -->
          <div class="mb-4">
            <label class="block text-sm font-medium mb-1">Status</label>
            <select
              formControlName="status"
              class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
            >
              <option value="active">Status: Active</option>
              <option value="inactive">Status: Inactive</option>
            </select>
          </div>
  
          <!-- Save Button -->
          <div class="text-left">
            <button
              type="submit"
              [disabled]="roleForm.invalid"
              class="bg-[#075FB0] hover:bg-blue-700 text-white font-medium py-2 px-4 rounded disabled:opacity-50"
            >
              Save
            </button>
          </div>
  
        </form>
        <!-- Form End -->
  
      </div>
    </div>
  
  </div>
  
</div>